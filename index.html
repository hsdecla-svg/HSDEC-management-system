<script>
        const USER_DB = {
            "Takashi": { pw: "Tks83446412", role: "admin" },
            "Chansouk": { pw: "97372185", role: "staff" },
            "Mim": { pw: "78277996", role: "staff" },
            "Chanthaviphone": { pw: "96086112", role: "vv" },
            "Sengmala": { pw: "22886998", role: "sv" }
        };

        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'en',
                headerToolbar: { left: 'prev', center: 'title', right: 'next' },
                fixedWeekCount: false,
                googleCalendarApiKey: 'AIzaSyCzE9RsYu1ec6_b0ePHj_7FEOh9aF0fQi0',
                events: {
                    googleCalendarId: 'hsdec.la@gmail.com'
                },
                height: 'auto',
                // 予定が描画されるたびに実行される（確実にドットを打つ）
                eventDidMount: function(info) {
                    const dayEl = info.el.closest('.fc-daygrid-day');
                    if (dayEl) {
                        dayEl.classList.add('has-event');
                    }
                },
                // リンクとしての動作を無効化してポップアップを表示
                eventClick: function(info) {
                    info.jsEvent.preventDefault();
                    showModal(info.event);
                }
            });
            calendar.render();
        });

        function showModal(event) {
            document.getElementById('modalTitle').innerText = event.title;
            // 日時の表示を見やすく調整
            const dateStr = event.allDay 
                ? event.start.toLocaleDateString('ja-JP') 
                : event.start.toLocaleString('ja-JP');
            document.getElementById('modalDate').innerText = dateStr;
            document.getElementById('modalDesc').innerText = event.extendedProps.description || '詳細な説明はありません。';
            document.getElementById('eventModal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('eventModal').style.display = 'none'; }

        function login() {
            const name = document.getElementById('user-select').value;
            const pass = document.getElementById('pass').value;
            const error = document.getElementById('error');
            if (USER_DB[name] && USER_DB[name].pw === pass) {
                location.href = 'worker.html'; 
            } else {
                error.classList.remove('hidden');
                setTimeout(() => { error.classList.add('hidden'); }, 2000);
            }
        }
    </script>
