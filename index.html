<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSDEC Management System</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const SUPABASE_URL = 'https://zgmqllufmqanixgwdjok.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_vOgl-K0RTxyK9i0WJp7UwA_PlwVgESz';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function App() {
            const [user, setUser] = useState(null);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(true);

            // 1. èµ·å‹•æ™‚ã«ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
            useEffect(() => {
                supabaseClient.auth.getSession().then(({ data: { session } }) => {
                    setUser(session?.user ?? null);
                    setLoading(false);
                });

                // 2. ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®å¤‰åŒ–ï¼ˆãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼‰ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ¤œçŸ¥
                const { data: { subscription } } = supabaseClient.auth.onAuthStateChange((_event, session) => {
                    setUser(session?.user ?? null);
                });

                return () => subscription.unsubscribe();
            }, []);

            const handleLogin = async (e) => {
                e.preventDefault();
                const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
                if (error) {
                    alert("ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: " + error.message);
                } else {
                    // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸã—ãŸã‚‰ React ã® setUser ãŒèµ°ã£ã¦è‡ªå‹•ã§ç”»é¢ãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™
                    console.log("ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ");
                }
            };

            if (loading) return <div class="p-10 text-center">èª­ã¿è¾¼ã¿ä¸­...</div>;

            // --- ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„å ´åˆ ---
            if (!user) {
                return (
                    <div class="min-h-screen flex items-center justify-center bg-blue-50 p-4">
                        <div class="max-w-md w-full bg-white rounded-2xl shadow-xl p-8">
                            <h1 class="text-2xl font-bold text-center text-blue-900 mb-8">HSDEC LOGIN</h1>
                            <form onSubmit={handleLogin} class="space-y-4">
                                <input type="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" class="w-full border p-3 rounded-lg" value={email} onChange={e => setEmail(e.target.value)} required />
                                <input type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" class="w-full border p-3 rounded-lg" value={password} onChange={e => setPassword(e.target.value)} required />
                                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition">ãƒ­ã‚°ã‚¤ãƒ³</button>
                            </form>
                        </div>
                    </div>
                );
            }

            // --- ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸã—ã¦ã„ã‚‹å ´åˆï¼ˆç®¡ç†ç”»é¢ï¼‰ ---
            return (
                <div class="min-h-screen flex flex-col md:flex-row">
                    <aside class="w-full md:w-64 bg-blue-900 text-white p-6">
                        <h1 class="text-xl font-bold mb-10">HSDEC GLOBAL</h1>
                        <nav class="space-y-4">
                            <div class="p-3 bg-blue-800 rounded">ğŸ“‚ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
                            <button onClick={() => supabaseClient.auth.signOut()} class="w-full bg-red-600 p-2 rounded text-sm mt-10">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                        </nav>
                    </aside>
                    <main class="flex-grow p-8 bg-gray-50 text-gray-800">
                        <h2 class="text-3xl font-extrabold mb-4">ç®¡ç†ç”»é¢ã¸ã‚ˆã†ã“ãï¼</h2>
                        <p class="text-green-600 font-bold">âœ… ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ãŒæ­£å¸¸ã«åæ˜ ã•ã‚Œã¾ã—ãŸã€‚</p>
                        <div class="mt-10 p-10 border-2 border-dashed border-gray-300 rounded-xl text-center text-gray-400">
                            ã“ã“ã«åŠ´åƒè€…ã®åç°¿ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
