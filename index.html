<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSDEC Global Platform</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@400;700&family=Noto+Sans+KR:wght@400;700;900&family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', 'Noto Sans Lao', 'Noto Sans KR', sans-serif; background-color: #f1f5f9; }
        .form-input { border: 2px solid #e2e8f0; padding: 0.8rem; border-radius: 0.8rem; width: 100%; outline: none; transition: 0.2s; font-size: 14px; background: #fff; }
        .form-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
        .label-text { font-size: 10px; font-weight: 900; color: #64748b; text-transform: uppercase; margin-bottom: 4px; display: block; margin-left: 4px; }
        .tab-btn { padding: 12px 24px; font-weight: 800; font-size: 11px; transition: 0.3s; border-bottom: 3px solid transparent; white-space: nowrap; text-transform: uppercase; }
        .tab-btn.active { color: #3b82f6; border-bottom-color: #3b82f6; background: #fff; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const SUPABASE_URL = 'https://zgmqllufmqanixgwdjok.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_vOgl-K0RTxyK9i0WJp7UwA_PlwVgESz';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const i18n = {
            en: { dash: "Dashboard", new: "New Entry", search: "Search Name, Address...", save: "Save Data", back: "Back", lang: "English", name: "Full Name", pass: "Passport No", status: "Status", basic: "Basic Info", village: "Village", district: "District", province: "Province", batch: "Batch No.", re_entry: "Entry Type", phone: "Phone", bday: "Birth Date", count: "Entry Count", new_v: "Newcomer", re_v: "Re-entry", all_b: "All Batches" },
            jp: { dash: "ÂêçÁ∞ø‰∏ÄË¶ß", new: "Êñ∞Ë¶èÁôªÈå≤", search: "ÂêçÂâç„Éª‰ΩèÊâÄ„ÅßÊ§úÁ¥¢...", save: "„Éá„Éº„Çø„Çí‰øùÂ≠ò", back: "Êàª„Çã", lang: "Êó•Êú¨Ë™û", name: "Ê∞èÂêç", pass: "„Éë„Çπ„Éù„Éº„ÉàÁï™Âè∑", status: "Ê¥æÈÅ£Áä∂Ê≥Å", basic: "Âü∫Êú¨ÊÉÖÂ†±", village: "Êùë", district: "Â∏Ç", province: "Áúå", batch: "Á¨¨‰ΩïÊúüÁîü", re_entry: "ÂÖ•ÂõΩÂå∫ÂàÜ", phone: "ÈõªË©±Áï™Âè∑", bday: "ÁîüÂπ¥ÊúàÊó•", count: "ÂÖ•ÂõΩÂõûÊï∞", new_v: "Êñ∞Ë¶èÂÖ•ÂõΩËÄÖ", re_v: "ÂÜçÂÖ•ÂõΩËÄÖ", all_b: "„Åô„Åπ„Å¶„ÅÆÊúüÁîü" },
            lao: { dash: "‡ªÅ‡∫ú‡∫á‡∫Ñ‡∫ß‡∫ö‡∫Ñ‡∫∏‡∫°", new: "‡∫•‡∫ª‡∫á‡∫ó‡∫∞‡∫ö‡∫Ω‡∫ô‡ªÉ‡ªù‡ªà", search: "‡∫Ñ‡∫ª‡ªâ‡∫ô‡∫´‡∫≤‡∫ä‡∫∑‡ªà, ‡∫ó‡∫µ‡ªà‡∫¢‡∫π‡ªà...", save: "‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô", back: "‡∫Å‡∫±‡∫ö‡∫Ñ‡∫∑‡∫ô", lang: "‡∫•‡∫≤‡∫ß", name: "‡∫ä‡∫∑‡ªà‡ªÄ‡∫ï‡∫±‡∫°", pass: "‡ªÄ‡∫•‡∫Å‡ªú‡∫±‡∫á‡∫™‡∫∑‡∫ú‡ªà‡∫≤‡∫ô‡ªÅ‡∫î‡∫ô", status: "‡∫™‡∫∞‡∫ñ‡∫≤‡∫ô‡∫∞", basic: "‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫û‡∫∑‡ªâ‡∫ô‡∫ñ‡∫≤‡∫ô", village: "‡∫ö‡ªâ‡∫≤‡∫ô", district: "‡ªÄ‡∫°‡∫∑‡∫≠‡∫á", province: "‡ªÅ‡∫Ç‡∫ß‡∫á", batch: "‡∫Æ‡∫∏‡ªà‡∫ô‡∫ó‡∫µ", re_entry: "‡∫õ‡∫∞‡ªÄ‡∫û‡∫î‡∫Å‡∫≤‡∫ô‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡ªÄ‡∫°‡∫∑‡∫≠‡∫á", phone: "‡ªÄ‡∫ö‡∫µ‡ªÇ‡∫ó‡∫•‡∫∞‡∫™‡∫±‡∫ö", bday: "‡∫ß‡∫±‡∫ô‡ªÄ‡∫î‡∫∑‡∫≠‡∫ô‡∫õ‡∫µ‡ªÄ‡∫Å‡∫µ‡∫î", count: "‡∫à‡∫≥‡∫ô‡∫ß‡∫ô‡∫Ñ‡∫±‡ªâ‡∫á‡∫ó‡∫µ‡ªà‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤", new_v: "‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡ªÉ‡ªù‡ªà", re_v: "‡∫Å‡∫±‡∫ö‡∫Ñ‡∫∑‡∫ô‡∫°‡∫≤‡ªÉ‡ªù‡ªà", all_b: "‡∫ó‡∫∏‡∫Å‡∫Æ‡∫∏‡ªà‡∫ô" },
            kr: { dash: "ÎåÄÏãúÎ≥¥Îìú", new: "Ïã†Í∑ú Îì±Î°ù", search: "Ïù¥Î¶Ñ, Ï£ºÏÜå Í≤ÄÏÉâ...", save: "Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•", back: "Îí§Î°ú", lang: "ÌïúÍµ≠Ïñ¥", name: "ÏÑ±Î™Ö", pass: "Ïó¨Í∂å Î≤àÌò∏", status: "ÏßÑÌñâ ÏÉÅÌÉú", basic: "Í∏∞Î≥∏ Ï†ïÎ≥¥", village: "ÎßàÏùÑ(Village)", district: "Ïãú/Íµ¨(District)", province: "ÎèÑ/ÏÑ±(Province)", batch: "Í∏∞Ïàò", re_entry: "ÏûÖÍµ≠ Íµ¨Î∂Ñ", phone: "Ï†ÑÌôîÎ≤àÌò∏", bday: "ÏÉùÎÖÑÏõîÏùº", count: "ÏûÖÍµ≠ ÌöüÏàò", new_v: "Ïã†Í∑ú ÏûÖÍµ≠", re_v: "Ïû¨ÏûÖÍµ≠", all_b: "Î™®Îì† Í∏∞Ïàò" }
        };

        function App() {
            const [lang, setLang] = useState('en'); // „Éá„Éï„Ç©„É´„Éà„ÅØËã±Ë™û
            const [view, setView] = useState('list');
            const [workers, setWorkers] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterBatch, setFilterBatch] = useState('All');
            const [activeTab, setActiveTab] = useState('basic');
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(false);
            const t = i18n[lang];

            const initialForm = { 
                id: null, name: '', phone: '', passport_no: '', gender: '', birth_date: '', 
                village: '', district: '', province: '', batch_no: '1',
                entry_type: 'New', entry_count: 1,
                topik_level: '', dispatch_status: 'Waiting', company_feedback: '' 
            };
            const [formData, setFormData] = useState(initialForm);

            useEffect(() => {
                supabaseClient.auth.getSession().then(({ data: { session } }) => {
                    setUser(session?.user ?? null);
                    if (session) fetchWorkers();
                });
            }, []);

            const fetchWorkers = async () => {
                setLoading(true);
                const { data } = await supabaseClient.from('workers').select('*').order('created_at', { ascending: false });
                setWorkers(data || []);
                setLoading(false);
            };

            const handleSave = async (e) => {
                e.preventDefault();
                setLoading(true);
                const dataToSave = { ...formData };
                if (!dataToSave.id) delete dataToSave.id;
                const { error } = await supabaseClient.from('workers').upsert([dataToSave]);
                if (error) alert(error.message);
                else {
                    alert("Success!");
                    setView('list');
                    fetchWorkers();
                }
                setLoading(false);
            };

            const filteredWorkers = workers.filter(w => {
                const searchStr = (w.name || "") + (w.passport_no || "") + (w.village || "") + (w.district || "") + (w.province || "");
                const matchSearch = searchStr.toLowerCase().includes(searchTerm.toLowerCase());
                const matchBatch = filterBatch === 'All' || String(w.batch_no) === filterBatch;
                return matchSearch && matchBatch;
            });

            if (!user) return <LoginForm supabase={supabaseClient} />;

            return (
                <div class="min-h-screen flex flex-col md:flex-row">
                    <aside class="w-full md:w-64 bg-slate-900 text-white p-6 flex-shrink-0 shadow-2xl z-10">
                        <div class="text-2xl font-black text-blue-400 mb-10 italic tracking-tighter">HSDEC GLOBAL</div>
                        <nav class="space-y-2 mb-10">
                            <button onClick={() => setView('list')} class={`w-full text-left p-4 rounded-xl font-bold transition ${view === 'list' ? 'bg-blue-600' : 'text-slate-400 hover:text-white'}`}>üìÇ {t.dash}</button>
                            <button onClick={() => { setFormData(initialForm); setView('edit'); }} class={`w-full text-left p-4 rounded-xl font-bold transition ${view === 'edit' ? 'bg-blue-600' : 'text-slate-400 hover:text-white'}`}>‚ûï {t.new}</button>
                        </nav>
                        
                        <div class="pt-6 border-t border-slate-800">
                            <label class="text-[9px] font-black text-slate-500 block mb-4 uppercase tracking-widest">Display Language</label>
                            <div class="grid grid-cols-2 gap-2">
                                {Object.keys(i18n).map(l => (
                                    <button key={l} onClick={() => setLang(l)} class={`px-2 py-2 rounded-lg text-[10px] font-bold border ${lang === l ? 'bg-blue-600 border-blue-600 text-white' : 'border-slate-700 text-slate-500'}`}>{i18n[l].lang}</button>
                                ))}
                            </div>
                        </div>
                    </aside>

                    <main class="flex-grow p-6 md:p-10 overflow-x-hidden">
                        {view === 'list' ? (
                            <div class="max-w-6xl mx-auto">
                                <div class="flex flex-col md:flex-row justify-between gap-4 mb-8 items-end">
                                    <div>
                                        <h2 class="text-3xl font-black text-slate-800 mb-2">{t.dash}</h2>
                                        <p class="text-slate-400 text-[10px] font-black uppercase tracking-widest">{filteredWorkers.length} {lang === 'en' ? 'Results' : 'Âêç„ÇíË°®Á§∫‰∏≠'}</p>
                                    </div>
                                    <div class="flex flex-wrap gap-2 w-full md:w-auto">
                                        <select class="form-input !w-40 shadow-sm" value={filterBatch} onChange={e => setFilterBatch(e.target.value)}>
                                            <option value="All">{t.all_b}</option>
                                            {[...Array(20)].map((_, i) => <option key={i+1} value={i+1}>{t.batch} {i+1}</option>)}
                                        </select>
                                        <input type="text" placeholder={t.search} class="form-input bg-white shadow-sm md:w-64" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {filteredWorkers.map(w => (
                                        <div key={w.id} onClick={() => { setFormData(w); setView('edit'); }} class="bg-white p-6 rounded-[2rem] shadow-sm hover:shadow-2xl transition-all cursor-pointer border border-white hover:border-blue-400 relative group">
                                            <div class="absolute top-6 right-6 text-[9px] font-black px-3 py-1 bg-slate-100 rounded-full text-slate-500">{t.batch} {w.batch_no}</div>
                                            <div class="font-black text-xl text-slate-800 mb-1 group-hover:text-blue-600">{w.name}</div>
                                            <div class="text-[10px] font-bold text-slate-400 mb-4">{w.province} / {w.district}</div>
                                            <div class="flex flex-wrap gap-2 pt-4 border-t border-slate-50">
                                                <span class="text-[9px] font-black bg-blue-50 text-blue-600 px-2 py-1 rounded uppercase">{w.entry_type === 'Re' ? t.re_v : t.new_v}</span>
                                                <span class="text-[9px] font-black bg-slate-100 text-slate-500 px-2 py-1 rounded">TOPIK: {w.topik_level || '-'}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <div class="max-w-4xl mx-auto bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border border-slate-200">
                                <div class="flex bg-slate-50 border-b overflow-x-auto scrollbar-hide">
                                    {['basic', 'docs', 'interview', 'dispatch'].map(id => (
                                        <button key={id} onClick={() => setActiveTab(id)} class={`tab-btn ${activeTab === id ? 'active' : 'text-slate-400'}`}>{t[id]}</button>
                                    ))}
                                </div>
                                <form onSubmit={handleSave} class="p-8 md:p-12">
                                    {activeTab === 'basic' && (
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 animate-in fade-in">
                                            <div class="md:col-span-2"><label class="label-text">{t.name}</label><input type="text" class="form-input" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} required /></div>
                                            <div><label class="label-text">{t.batch}</label>
                                                <select class="form-input" value={formData.batch_no} onChange={e => setFormData({...formData, batch_no: e.target.value})}>
                                                    {[...Array(20)].map((_, i) => <option key={i+1} value={i+1}>{t.batch} {i+1}</option>)}
                                                </select>
                                            </div>
                                            <div><label class="label-text">{t.province}</label><input type="text" class="form-input" value={formData.province} onChange={e => setFormData({...formData, province: e.target.value})} /></div>
                                            <div><label class="label-text">{t.district}</label><input type="text" class="form-input" value={formData.district} onChange={e => setFormData({...formData, district: e.target.value})} /></div>
                                            <div><label class="label-text">{t.village}</label><input type="text" class="form-input" value={formData.village} onChange={e => setFormData({...formData, village: e.target.value})} /></div>
                                            
                                            <div class="md:col-span-3 p-6 bg-slate-50 rounded-2xl grid grid-cols-2 gap-4">
                                                <div><label class="label-text">{t.re_entry}</label>
                                                    <select class="form-input" value={formData.entry_type} onChange={e => setFormData({...formData, entry_type: e.target.value})}>
                                                        <option value="New">{t.new_v}</option>
                                                        <option value="Re">{t.re_v}</option>
                                                    </select>
                                                </div>
                                                <div><label class="label-text">{t.count}</label><input type="number" class="form-input" value={formData.entry_count} onChange={e => setFormData({...formData, entry_count: e.target.value})} /></div>
                                            </div>
                                            
                                            <div><label class="label-text">{t.pass}</label><input type="text" class="form-input" value={formData.passport_no} onChange={e => setFormData({...formData, passport_no: e.target.value})} /></div>
                                            <div><label class="label-text">{t.phone}</label><input type="text" class="form-input" value={formData.phone} onChange={e => setFormData({...formData, phone: e.target.value})} /></div>
                                            <div><label class="label-text">{t.bday}</label><input type="date" class="form-input" value={formData.birth_date} onChange={e => setFormData({...formData, birth_date: e.target.value})} /></div>
                                        </div>
                                    )}
                                    {/* Dispatch/Docs etc Tabs */}
                                    {activeTab === 'dispatch' && (
                                        <div class="space-y-6">
                                            <div><label class="label-text">{t.status}</label><select class="form-input" value={formData.dispatch_status} onChange={e => setFormData({...formData, dispatch_status: e.target.value})}><option value="Waiting">Waiting</option><option value="Dispatched">Dispatched</option></select></div>
                                            <div><label class="label-text">Memo / Feedback</label><textarea class="form-input h-32" value={formData.company_feedback} onChange={e => setFormData({...formData, company_feedback: e.target.value})} /></div>
                                        </div>
                                    )}

                                    <div class="mt-12 flex justify-between items-center pt-8 border-t border-slate-100">
                                        <button type="button" onClick={() => setView('list')} class="text-slate-400 font-bold hover:text-slate-600 transition">‚Üê {t.back}</button>
                                        <button type="submit" disabled={loading} class="px-10 py-4 bg-blue-600 text-white rounded-2xl font-black text-xs uppercase tracking-widest shadow-xl shadow-blue-500/30 hover:bg-blue-700 transition disabled:opacity-50">
                                            {loading ? '...' : t.save}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        function LoginForm({ supabase }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const handleLogin = async (e) => {
                e.preventDefault();
                const { error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) alert(error.message);
            };
            return (
                <div class="min-h-screen flex items-center justify-center bg-slate-950 p-6">
                    <form onSubmit={handleLogin} class="bg-white p-12 rounded-[3rem] shadow-2xl w-full max-w-sm">
                        <h2 class="text-3xl font-black mb-10 text-center tracking-tighter">HSDEC LOGIN</h2>
                        <input type="email" placeholder="Email" class="form-input mb-4" onChange={e => setEmail(e.target.value)} required />
                        <input type="password" placeholder="Password" class="form-input mb-8" onChange={e => setPassword(e.target.value)} required />
                        <button class="w-full bg-blue-600 text-white py-5 rounded-2xl font-black shadow-xl">Login</button>
                    </form>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
